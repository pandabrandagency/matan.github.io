<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Panda CRM — דשבורד</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<style>
  :root{
    --bg:#0b1220;--card:#0f1a2e;--text:#ffffff;--muted:#b7c4d6;--primary:#5eead4;--danger:#ef4444;--accent:#60a5fa;--chip:#1f2a44;--border:#20314f;
    --radius:14px; --font: system-ui,-apple-system,Segoe UI,Heebo,Arial; --base:16px;
  }
  html{font-size:var(--base)}
  body{background:var(--bg);color:var(--text);font-family:var(--font)}
  .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius)}
  .chip{background:var(--chip);color:var(--muted);border-radius:999px;padding:.2rem .6rem;display:inline-block;margin:.1rem .15rem;font-size:.8rem}
  .logo{height:42px;width:42px;object-fit:contain;background:#0b1425;border:1px solid var(--border);border-radius:10px}
  .toolbar .btn{white-space:nowrap}
  .badge-exp{background:#3a1020;color:#ff7a7a;border:1px solid #6b1935}
  .toast-container{position:fixed;inset:auto 1rem 1rem auto;z-index:2000}
  .progress{height:8px;background:#1a2340}
  .progress-bar{background:linear-gradient(90deg,#22d3ee,#a78bfa)}
  a,button{cursor:pointer}
</style>
</head>
<body>
<div class="container py-3">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center gap-2">
      <img id="agencyLogo" class="logo" alt="logo">
      <div>
        <div class="fw-bold">Panda CRM — דשבורד</div>
        <small class="text-secondary" id="topHint"></small>
      </div>
    </div>
    <div class="d-flex align-items-center gap-2">
      <span id="health" class="badge text-bg-secondary">בטוח</span>
      <button class="btn btn-sm btn-outline-info" id="btnHealthTop"><i class="bi bi-activity me-1"></i>בדיקת בריאות</button>
    </div>
  </div>

  <div class="card p-3 mb-3 toolbar">
    <div class="row g-2 align-items-end">
      <div class="col-12 col-md-4">
        <label class="form-label">חיפוש</label>
        <input id="q" class="form-control form-control-sm" placeholder="שם/תגיות/אימייל">
      </div>
      <div class="col-6 col-md-2">
        <label class="form-label">מיון</label>
        <select id="sort" class="form-select form-select-sm">
          <option value="name">שם</option>
          <option value="createdAt">נוצר</option>
          <option value="updatedAt">עודכן</option>
        </select>
      </div>
      <div class="col-6 col-md-3">
        <label class="form-label">תגיות</label>
        <div id="tagsBar"></div>
      </div>
      <div class="col-12 col-md-3 d-flex gap-2 justify-content-md-end mt-2 mt-md-0">
        <button class="btn btn-sm btn-outline-light" id="btnPdfSel"><i class="bi bi-filetype-pdf me-1"></i>PDF (נבחרים)</button>
        <button class="btn btn-sm btn-outline-light" id="btnXlsxSel"><i class="bi bi-filetype-xls me-1"></i>XLSX (נבחרים)</button>
      </div>
    </div>
    <div class="mt-3 d-flex flex-wrap gap-2">
      <button class="btn btn-sm btn-success" id="btnNew"><i class="bi bi-plus-lg me-1"></i>לקוח חדש</button>
      <button class="btn btn-sm btn-outline-info" id="btnSendLinks"><i class="bi bi-link-45deg me-1"></i>שלח קישורי צפייה</button>
      <div class="ms-auto d-flex gap-2">
        <button class="btn btn-sm btn-outline-light" id="btnTheme"><i class="bi bi-palette2 me-1"></i>הגדרות תצוגה</button>
        <button class="btn btn-sm btn-warning" id="btnCRM"><i class="bi bi-gear me-1"></i>הגדרות CRM</button>
      </div>
    </div>
  </div>

  <div id="stats" class="d-flex flex-wrap gap-2 mb-2 small text-secondary"></div>
  <div id="grid" class="row g-3"></div>
</div>

<!-- Theme Settings Modal -->
<div class="modal fade" id="themeModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content" style="background:#0f1a2e;color:#fff;border:1px solid #20314f">
      <div class="modal-header">
        <h5 class="modal-title"><i class="bi bi-palette2 me-2"></i>הגדרות תצוגה</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-6"><label class="form-label">צבע טקסט</label><input type="color" id="th_text" class="form-control form-control-color" value="#ffffff"></div>
          <div class="col-6"><label class="form-label">צבע רקע</label><input type="color" id="th_bg" class="form-control form-control-color" value="#0b1220"></div>
          <div class="col-6"><label class="form-label">צבע כרטיס</label><input type="color" id="th_card" class="form-control form-control-color" value="#0f1a2e"></div>
          <div class="col-6"><label class="form-label">צבע גבולות</label><input type="color" id="th_border" class="form-control form-control-color" value="#20314f"></div>
          <div class="col-12"><label class="form-label">גופן</label>
            <select id="th_font" class="form-select">
              <option value="Heebo">Heebo</option>
              <option value="Rubik">Rubik</option>
              <option value="Assistant">Assistant</option>
              <option value="system-ui,-apple-system,Segoe UI,Arial">System</option>
            </select>
          </div>
          <div class="col-6"><label class="form-label">גודל בסיס (px)</label><input type="number" id="th_base" class="form-control" min="14" max="20" step="1" value="16"></div>
          <div class="col-6"><label class="form-label">רדיוס פינות (px)</label><input type="number" id="th_radius" class="form-control" min="8" max="24" step="1" value="14"></div>
          <div class="col-6"><label class="form-label">גודל לוגו (סקייל 0.7–2)</label><input type="number" id="th_logoScale" class="form-control" min="0.7" max="2" step="0.1" value="1"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="btnThemeSave">שמור</button>
      </div>
    </div>
  </div>
</div>

<!-- CRM Settings Modal -->
<div class="modal fade" id="crmModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content" style="background:#0f1a2e;color:#fff;border:1px solid #20314f">
      <div class="modal-header">
        <h5 class="modal-title"><i class="bi bi-gear me-2"></i>הגדרות CRM</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Apps Script Web App URL (/exec)</label>
          <input id="apiBase" class="form-control" placeholder="https://script.google.com/macros/s/.../exec">
          <div class="form-text">הדבק כאן את הכתובת מה־Web App שהגדרת ב־Apps Script (גישה: Anyone).</div>
        </div>
        <div class="mb-3">
          <label class="form-label">שלבי ברירת מחדל (משימות)</label>
          <input id="phases" class="form-control" placeholder="אפיון,עיצוב,פיתוח,QA,אחר">
        </div>
        <div class="mb-3">
          <label class="form-label">תבנית דיוור HTML (שליחת קישור צפייה)</label>
          <textarea id="mailTpl" class="form-control" rows="4" placeholder="שלום {name}, זה הלינק שלך: {link} והסיסמה: {pass}"></textarea>
          <div class="form-text">מפתחות תבנית: {name} {link} {pass}</div>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-primary" id="btnSaveCRM">שמור</button>
          <button class="btn btn-outline-info" id="btnHealth">בדיקת חיבור</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="toast-container" id="toasts"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const SKEY = "panda_clients";
const CKEY = "panda_cfg";
const TKEY = "panda_theme";
const $ = (s,root=document)=>root.querySelector(s);
const $$ = (s,root=document)=>Array.from(root.querySelectorAll(s));
const toast = (msg,type="info") => {
  const box = document.createElement("div");
  box.className = "toast align-items-center text-bg-" + (type==="error"?"danger":type);
  box.setAttribute("role","alert"); box.setAttribute("aria-live","assertive"); box.setAttribute("aria-atomic","true");
  box.innerHTML = `<div class="d-flex"><div class="toast-body">${msg}</div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div>`;
  $("#toasts").appendChild(box);
  new bootstrap.Toast(box,{delay:3000}).show();
};

const cfg = {
  get all(){ try{return JSON.parse(localStorage.getItem(CKEY))||{};}catch{return{};} },
  set all(v){ localStorage.setItem(CKEY, JSON.stringify(v)); },
  get apiBase(){ return (cfg.all.apiBase||"").trim(); },
  set apiBase(v){ let c=cfg.all;c.apiBase=v;cfg.all=c; },
  get phases(){ return (cfg.all.phases||"אפיון,עיצוב,פיתוח,QA,אחר"); },
  set phases(v){ let c=cfg.all;c.phases=v;cfg.all=c; },
  get mailTpl(){ return cfg.all.mailTpl || "שלום {name}, הקישור לצפייה: {link} והסיסמה: {pass}"; },
  set mailTpl(v){ let c=cfg.all;c.mailTpl=v;cfg.all=c; },
};

const theme = {
  get all(){ try{return JSON.parse(localStorage.getItem(TKEY))||{};}catch{return{};} },
  set all(v){ localStorage.setItem(TKEY, JSON.stringify(v)); },
  apply(){
    const t = theme.all;
    const r = document.documentElement.style;
    if(t.text)   r.setProperty("--text", t.text);
    if(t.bg)     r.setProperty("--bg", t.bg);
    if(t.card)   r.setProperty("--card", t.card);
    if(t.border) r.setProperty("--border", t.border);
    if(t.font){ loadFont(t.font); r.setProperty("--font", t.font.includes(",")? t.font : `'${t.font}', var(--font)`); }
    if(t.base)   r.setProperty("--base", t.base+"px");
    if(t.radius) r.setProperty("--radius", t.radius+"px");
    if(t.logoScale) document.querySelectorAll(".logo").forEach(el=> el.style.transform=`scale(${t.logoScale})`);
  }
};

function loadFont(f){
  if(!f || f.includes(",")) return;
  const id="font-"+f;
  if(document.getElementById(id)) return;
  const link=document.createElement("link");
  link.id=id; link.rel="stylesheet";
  link.href=`https://fonts.googleapis.com/css2?family=${encodeURIComponent(f)}:wght@300;400;500;700&display=swap`;
  document.head.appendChild(link);
}

const store = {
  get all(){ try{return JSON.parse(localStorage.getItem(SKEY))||[];}catch{return[];} },
  set all(v){ localStorage.setItem(SKEY, JSON.stringify(v)); },
  upsert(c){
    const arr=store.all;
    const i=arr.findIndex(x=>x.id===c.id);
    if(i>=0) arr[i]=c; else arr.push(c);
    store.all=arr;
  },
  remove(id){ store.all = store.all.filter(x=>x.id!==id); }
};

const postJSON = async (action, payload={}) => {
  const base = cfg.apiBase;
  if(!base){ throw new Error("חסר API"); }
  const res = await fetch(base+"?action="+encodeURIComponent(action), {
    method:"POST",
    headers:{ "Content-Type":"text/plain" },
    body: JSON.stringify(payload)
  });
  if(!res.ok) throw new Error("שגיאת רשת "+res.status);
  return await res.json();
};

const cryptoRand = () => crypto.getRandomValues(new Uint32Array(1))[0].toString(16)+Date.now().toString(16);

const norm = (c={}) => ({
  id: c.id || cryptoRand(),
  name: c.name || "לקוח חדש",
  contact_person: c.contact_person || "",
  phone: c.phone || "",
  email: c.email || "",
  address: c.address || "",
  tags: c.tags || "",
  website: c.website || "",
  brand: c.brand || "",
  logo_main: c.logo_main || "",
  access: c.access || [],
  tasks: c.tasks || [],
  links: c.links || [],
  people: c.people || [],
  extra: c.extra || [],
  domStart: c.domStart || "",
  domExp: c.domExp || "",
  hostStart: c.hostStart || "",
  hostExp: c.hostExp || "",
  notes: c.notes || "",
  viewerPass: c.viewerPass || "",
  createdAt: c.createdAt || new Date().toISOString().slice(0,10),
  updatedAt: new Date().toISOString().slice(0,10)
});

function leftDays(d){ if(!d) return null; const dd=new Date(d); if(isNaN(dd))return null; return Math.ceil((dd - new Date())/(1000*60*60*24)); }

function sampleIfEmpty(){
  if(store.all.length) return;
  store.all = [
    norm({ name:"יהודית תכשיטים", tags:"אתר,מיתוג", domExp:"2025-12-31", hostExp:"2025-11-20",
           tasks:[{title:"דפי מוצר",phase:"פיתוח",done:false},{title:"באנרים",phase:"עיצוב",done:true}] }),
    norm({ name:"Tashiada", tags:"לימוד,עמותה", domExp:"2026-01-30",
           tasks:[{title:"מידע מסלולים",phase:"אפיון",done:true},{title:"טפסי הרשמה",phase:"פיתוח",done:false}] })
  ];
}

function render(){
  const q = ($("#q").value||"").trim().toLowerCase();
  const tag = ($("#tagsBar .chip.active")?.dataset?.tag)||"";
  const sort = $("#sort").value;
  let arr = store.all.slice();
  if(q){ arr = arr.filter(c=> (c.name+c.tags+c.email).toLowerCase().includes(q)); }
  if(tag){ arr = arr.filter(c=> (c.tags||"").toLowerCase().split(",").map(s=>s.trim()).includes(tag)); }
  arr.sort((a,b)=>{ if(sort==="name") return a.name.localeCompare(b.name,'he'); return (b[sort]||"").localeCompare(a[sort]||""); });

  // stats
  const total = arr.length;
  const expSoon = arr.filter(c=> [c.domExp,c.hostExp].some(d=>{const L=leftDays(d);return L!==null && L<=30;})).length;
  const avgProg = Math.round((arr.reduce((s,c)=> s + (c.tasks.length?(c.tasks.filter(t=>t.done).length/c.tasks.length):0),0) / (arr.length||1))*100);
  $("#stats").innerHTML = `<span class="chip">סה״כ: ${total}</span><span class="chip">התראות פקיעה ≤30 יום: ${expSoon}</span><span class="chip">השלמה ממוצעת: ${avgProg}%</span>`;

  // tags
  const tags = new Set();
  store.all.forEach(c=> (c.tags||"").split(",").map(s=>s.trim().toLowerCase()).filter(Boolean).forEach(t=>tags.add(t)));
  $("#tagsBar").innerHTML = Array.from(tags).map(t=>`<span class="chip" data-tag="${t}">${t}</span>`).join("") || '<span class="text-secondary">אין תגיות</span>';
  $$("#tagsBar .chip").forEach(el=> el.onclick=()=>{ $$("#tagsBar .chip").forEach(x=>x.classList.remove("active")); el.classList.add("active"); render(); });

  // grid
  const g = $("#grid"); g.innerHTML="";
  arr.forEach(c=>{
    const done = c.tasks.filter(t=>t.done).length;
    const prog = c.tasks.length? Math.round((done/c.tasks.length)*100): 0;
    const ld = leftDays(c.domExp), lh = leftDays(c.hostExp);
    const warn = (ld!==null && ld<=30) || (lh!==null && lh<=30);
    const col = document.createElement("div");
    col.className="col-12 col-md-6 col-lg-4";
    col.innerHTML = `
      <div class="card p-3 h-100 d-flex flex-column">
        <div class="d-flex align-items-center justify-content-between">
          <div class="d-flex align-items-center gap-2">
            <img src="${c.logo_main||''}" class="logo" alt="">
            <div>
              <div class="fw-bold">${c.name}</div>
              <div class="small text-secondary">${c.email||""}</div>
            </div>
          </div>
          <div class="form-check"><input class="form-check-input sel" type="checkbox" data-id="${c.id}"></div>
        </div>
        <div class="mt-2">${(c.tags||"").split(",").filter(Boolean).map(t=>`<span class="chip">${t.trim()}</span>`).join(" ")}</div>
        <div class="mt-2">
          <div class="progress"><div class="progress-bar" style="width:${prog}%"></div></div>
          <div class="d-flex justify-content-between small text-secondary mt-1"><span>התקדמות</span><span>${prog}%</span></div>
        </div>
        <div class="d-flex gap-2 mt-3 flex-wrap">
          ${warn?'<span class="badge badge-exp">⚠️ פקיעה קרובה</span>':''}
          ${c.domExp?`<span class="chip">דומיין: ${c.domExp}</span>`:''}
          ${c.hostExp?`<span class="chip">אחסון: ${c.hostExp}</span>`:''}
        </div>
        <div class="mt-auto d-flex gap-2 pt-3">
          <a class="btn btn-sm btn-primary" href="client.html?id=${encodeURIComponent(c.id)}"><i class="bi bi-pencil"></i> פתח</a>
          <a class="btn btn-sm btn-outline-light" target="_blank" href="client.html?id=${encodeURIComponent(c.id)}&view=1"><i class="bi bi-eye"></i> צפייה</a>
          <button class="btn btn-sm btn-outline-danger btn-del" data-id="${c.id}"><i class="bi bi-trash"></i></button>
        </div>
      </div>`;
    g.appendChild(col);
  });

  $$(".btn-del").forEach(b=> b.onclick=()=>{
    const id = b.dataset.id;
    if(confirm("למחוק לקוח?")){ store.remove(id); toast("נמחק","warning"); render(); }
  });
}

async function pdfSelected(){
  const ids = $$(".sel:checked").map(i=>i.dataset.id);
  if(!ids.length) return toast("לא נבחרו לקוחות","warning");
  const container = document.createElement("div");
  container.style.direction="rtl";
  ids.forEach(id=>{
    const c = store.all.find(x=>x.id===id); if(!c) return;
    const done = c.tasks.filter(t=>t.done).length;
    const prog = c.tasks.length? Math.round((done/c.tasks.length)*100):0;
    const card = document.createElement("div");
    card.style.pageBreakAfter="always";
    card.innerHTML = `<h3>${c.name}</h3>
      <div><b>איש קשר:</b> ${c.contact_person||""} | <b>טלפון:</b> ${c.phone||""} | <b>אימייל:</b> ${c.email||""}</div>
      <div><b>תגיות:</b> ${c.tags||""}</div>
      <div><b>התקדמות:</b> ${prog}%</div>`;
    container.appendChild(card);
  });
  await html2pdf().from(container).save("clients.pdf");
}

function sheetFromClients(ids){
  const all = store.all.filter(c=> ids.includes(c.id));
  const rows = all.map(c=>({
    id:c.id,name:c.name,contact:c.contact_person,phone:c.phone,email:c.email,tags:c.tags,
    domStart:c.domStart,domExp:c.domExp,hostStart:c.hostStart,hostExp:c.hostExp,
    progress: (c.tasks.length? Math.round((c.tasks.filter(t=>t.done).length/c.tasks.length)*100):0) + "%"
  }));
  const ws = XLSX.utils.json_to_sheet(rows);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Clients');
  const wbout = XLSX.write(wb,{bookType:'xlsx',type:'array'});
  const blob = new Blob([wbout],{type:'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'clients.xlsx';
  a.click();
  setTimeout(()=>URL.revokeObjectURL(a.href), 3000);
}

async function xlsxSelected(){
  const ids = $$(".sel:checked").map(i=>i.dataset.id);
  if(!ids.length) return toast("לא נבחרו לקוחות","warning");
  sheetFromClients(ids);
}

async function sendViewLinks(){
  const ids = $$(".sel:checked").map(i=>i.dataset.id);
  if(!ids.length) return toast("לא נבחרו לקוחות","warning");
  const baseUrl = location.origin + location.pathname.replace(/[^\/]*$/,'');
  const lines = ids.map(id=>{
    const c = store.all.find(x=>x.id===id);
    const url = baseUrl + `client.html?id=${encodeURIComponent(id)}&view=1`;
    return `${c?.name||id}: ${url}`;
  }).join('\n');
  await navigator.clipboard.writeText(lines);
  toast("קישורי צפייה הועתקו ללוח","success");
}

function applyThemeForm(){
  const t = theme.all;
  $("#th_text").value = t.text || "#ffffff";
  $("#th_bg").value = t.bg || "#0b1220";
  $("#th_card").value = t.card || "#0f1a2e";
  $("#th_border").value = t.border || "#20314f";
  $("#th_font").value = t.font || "Heebo";
  $("#th_base").value = t.base || 16;
  $("#th_radius").value = t.radius || 14;
  $("#th_logoScale").value = t.logoScale || 1;
}

function init(){
  // logo
  const agencyLogo = $("#agencyLogo");
  agencyLogo.src = "logo.jpeg"; // אם לא קיים, יוסר
  agencyLogo.onerror = ()=>{ agencyLogo.remove(); };

  // apply theme
  theme.apply();

  if(!localStorage.getItem(CKEY)){
    cfg.all = { apiBase:"", phases:"אפיון,עיצוב,פיתוח,QA,אחר" };
  }
  sampleIfEmpty();
  render();

  // events
  $("#q").oninput = render;
  $("#sort").onchange = render;
  $("#btnPdfSel").onclick = pdfSelected;
  $("#btnXlsxSel").onclick = xlsxSelected;
  $("#btnSendLinks").onclick = sendViewLinks;
  $("#btnNew").onclick = ()=>{ const c=norm(); store.upsert(c); location.href="client.html?id="+encodeURIComponent(c.id); };

  // settings
  $("#btnTheme").onclick = ()=>{ applyThemeForm(); new bootstrap.Modal("#themeModal").show(); };
  $("#btnCRM").onclick = ()=>{ $("#apiBase").value=cfg.apiBase; $("#phases").value=cfg.phases; $("#mailTpl").value=cfg.mailTpl; new bootstrap.Modal("#crmModal").show(); };
  $("#btnThemeSave").onclick = ()=>{
    theme.all = {
      text:$("#th_text").value,bg:$("#th_bg").value,card:$("#th_card").value,border:$("#th_border").value,
      font:$("#th_font").value,base:Number($("#th_base").value),radius:Number($("#th_radius").value),
      logoScale:Number($("#th_logoScale").value)
    };
    theme.apply(); toast("תצוגה נשמרה","success");
  };
  $("#btnSaveCRM").onclick = ()=>{
    cfg.apiBase = $("#apiBase").value.trim();
    cfg.phases = $("#phases").value.trim();
    cfg.mailTpl = $("#mailTpl").value;
    toast("הגדרות CRM נשמרו","success");
  };
  $("#btnHealth").onclick = async()=>{
    try{ if(!cfg.apiBase) throw 0; const r = await fetch(cfg.apiBase+"?action=pull_all",{method:"POST",headers:{"Content-Type":"text/plain"},body:"{}"});
      if(!r.ok) throw 0; $("#health").className="badge text-bg-success"; $("#health").textContent="מחובר"; toast("החיבור ל־Apps Script תקין","success"); }
    catch{ $("#health").className="badge text-bg-secondary"; $("#health").textContent="בטוח"; toast("לא מחובר — מצב בטוח","warning"); }
  };
  $("#btnHealthTop").onclick = ()=> $("#btnHealth").click();

  // hint
  $("#topHint").textContent = cfg.apiBase? "מחובר ל-Apps Script" : "מצב בטוח (ללא API) — הכל מקומי";
}

document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>